<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Lindon 13th Ward Children's Sacrament Meeting Presentation Songs</title>
        <meta name="description" content="Resources to learn the Lindon 13th Ward Children's Sacrament Meeting Presentation Songs">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="css/styles.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Glory&display=swap" rel="stylesheet">
        <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
        <link rel="icon" type="image/x-icon" href="favicon.ico?">
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
        <![endif]--> 
        <div id="main" class="min-h-screen flex flex-col items-center justify-start">
            <div class="w-20 h-20 flex items-center justify-center mt-4 md:w-32 md:h-32">
                <img src="/static/images/flame.png" id="flame" class="transition-all ease-in-out w-16 h-16 md:w-20 md:h-20" alt="flame" />
            </div>
            <div class="pids-wrapper flex flex-col-reverse items-center justify-center rounded-full px-4 py-6 mt-2 border bg-gray-100 shadow">
                <div class="pid h-8 md:h-10 w-10" style="border-bottom-left-radius: 5px; border-bottom-right-radius: 5px;"></div>
                <div class="pid h-8 md:h-10 w-10"></div>
                <div class="pid h-8 md:h-10 w-10"></div>
                <div class="pid h-8 md:h-10 w-10"></div>
                <div class="pid h-8 md:h-10 w-10"></div>
                <div class="pid h-8 md:h-10 w-10"></div>
                <div class="pid h-8 md:h-10 w-10"></div>
                <div class="pid h-8 md:h-10 w-10"></div>
                <div class="pid h-8 md:h-10 w-10"></div>
                <div class="pid h-8 md:h-10 w-10" style="border-top-left-radius: 5px; border-top-right-radius: 5px;"></div>
            </div>
            <div class="w-20 h-20 mb-12 flex items-center justify-center mt-2 md:w-32 md:h-32">
                <img src="/static/images/snowflake.png" id="snowflake" class="transition-all ease-in-out w-16 h-16 md:w-20 md:h-20" alt="snowflake"></div>
            </div>
            <footer class="h-24 bg-green-200 flex flex-col items-end justify-center w-full">
                <a class="pr-4 hover:underline" href="/primary-presentation-2021/">v1</a>
                <p class="pr-4">&copy; <span id="year">2021</span> <a href="https://github.com/ethyl2" target="_blank">Heather Nuffer</a></p>
            </footer>
        </div>
        <script type="text/javascript">
            // Adapted from https://stackoverflow.com/questions/33322681/checking-microphone-volume-in-javascript/50279260#50279260
            const backgroundDiv = document.querySelector('#main')
            const flameDiv = document.querySelector('#flame')
            const snowflakeDiv = document.querySelector('#snowflake')
            const smallClasses = ['w-16', 'h-16', 'md:w-20', 'md:h-20']
            const largeClasses = ['w-20', 'h-20', 'md:w-32', 'md:h-32']
            console.log(...smallClasses)
           
            navigator.mediaDevices.getUserMedia({ audio: true, video: true })
                .then(function(stream) {
                audioContext = new AudioContext();
                analyser = audioContext.createAnalyser();
                microphone = audioContext.createMediaStreamSource(stream);
                javascriptNode = audioContext.createScriptProcessor(2048, 1, 1);

                analyser.smoothingTimeConstant = 0.8;
                analyser.fftSize = 1024;

                microphone.connect(analyser);
                analyser.connect(javascriptNode);
                javascriptNode.connect(audioContext.destination);
                javascriptNode.onaudioprocess = function() {
                    var array = new Uint8Array(analyser.frequencyBinCount);
                    analyser.getByteFrequencyData(array);
                    var values = 0;

                    var length = array.length;
                    for (var i = 0; i < length; i++) {
                        values += (array[i]);
                    }

                    var average = values / length;

                   // console.log(Math.round(average));
                    colorPids(average);
                }
            })
            .catch(function(err) {
                /* handle the error */
            });
            function colorPids(vol) {
                let all_pids = document.querySelectorAll('.pid')
                
                let amount_of_pids = Math.round(vol/10);
                let elem_range = [... all_pids].slice(0, amount_of_pids)
                // console.log(elem_range)
                for (var i = 0; i < all_pids.length; i++) {
                    all_pids[i].style.backgroundColor="#e6e7e8";
                }
                for (var i = 0; i < elem_range.length; i++) {
                    // console.log(elem_range[i]);
                    elem_range[i].style.backgroundColor="red";
                }
                if (elem_range.length > 5) {
                    flameDiv.classList.remove(...smallClasses)
                    flameDiv.classList.add(...largeClasses)
                    snowflakeDiv.classList.remove(...largeClasses)
                    snowflakeDiv.classList.add(...smallClasses)
                } else {
                    snowflakeDiv.classList.remove(...smallClasses)
                    snowflakeDiv.classList.add(...largeClasses)
                    flameDiv.classList.remove(...largeClasses)
                    flameDiv.classList.add(...smallClasses)
                }
            }
        </script>
    </body>
</html>
